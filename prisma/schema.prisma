generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String     @id @default(uuid())
  mobileNumber      String
  dob               DateTime?
  email             String?
  name              String?
  profilePictureUrl String?
  age               Int?
  topSize           String?
  bottomSize        String?
  gender            String?

  cart      Cart?
  orders    Order[]
  wishlist  Wishlist[]
  addresses Address[]
  reviews   Review[]
}

model Product {
  id               Int      @id @default(autoincrement())
  name             String   @unique
  categoryId       Int?
  subCategoryId    Int?
  imageUrl         String?
  shortDescription String?
  longDescription  String?
  stockAvailable   Int      @default(0)
  clicks           Int      @default(0)
  trending         Boolean  @default(false)
  createdAt        DateTime @default(now())

  category    Category?    @relation(fields: [categoryId], references: [id])
  subCategory SubCategory? @relation(fields: [subCategoryId], references: [id])

  cartItems     CartItem[]
  orderItems    OrderItem[]
  wishlist      Wishlist[]
  productImages ProductImage[]
  colors        ProductColor[]
  reviews       Review[]
  collection    Collection?    @relation(fields: [collectionId], references: [id])
  collectionId  Int?
  brand         Brand?         @relation(fields: [brandId], references: [id])
  brandId       Int?
}

model Brand {
  id           Int         @id @default(autoincrement())
  name         String      @unique
  logoUrl      String?
  products     Product[]
  collection   Collection? @relation(fields: [collectionId], references: [id])
  collectionId Int?
}

model ProductColor {
  id        Int    @id @default(autoincrement())
  productId Int
  color     String
  imageUrl  String?

  product   Product       @relation(fields: [productId], references: [id], onDelete: Cascade)
  sizes     ProductSize[]
  cartItems CartItem[]
}

model ProductSize {
  id      Int    @id @default(autoincrement())
  colorId Int
  size    String
  stock   Int    @default(0)
  price         Float
  originalPrice Float?

  color     ProductColor @relation(fields: [colorId], references: [id], onDelete: Cascade)
  cartItems CartItem[]
}

model ProductImage {
  id        Int     @id @default(autoincrement())
  productId Int
  imageUrl  String
  isPrimary Boolean @default(false)

  product Product @relation(fields: [productId], references: [id])
}

model Category {
  id            Int           @id @default(autoincrement())
  name          String
  imageUrl      String?
  subCategories SubCategory[]
  products      Product[]

  homeCategory HomeCategory[]
  collection   Collection?    @relation(fields: [collectionId], references: [id])
  collectionId Int?
}

model SubCategory {
  id           Int         @id @default(autoincrement())
  name         String
  imageUrl     String?
  categoryId   Int
  category     Category    @relation(fields: [categoryId], references: [id])
  products     Product[]
  collection   Collection? @relation(fields: [collectionId], references: [id])
  collectionId Int?
}

model Cart {
  id     Int        @id @default(autoincrement())
  userId String     @unique
  user   User       @relation(fields: [userId], references: [id])
  items  CartItem[]
}

model CartItem {
  id              Int @id @default(autoincrement())
  cartId          Int
  productId       Int
  productColorId  Int?
  productSizeId   Int?
  quantity        Int @default(1)

  cart         Cart         @relation(fields: [cartId], references: [id])
  product      Product      @relation(fields: [productId], references: [id])
  productColor ProductColor? @relation(fields: [productColorId], references: [id])
  productSize  ProductSize?  @relation(fields: [productSizeId], references: [id])
}

model Wishlist {
  id        Int @id @default(autoincrement())
  userId    String
  productId Int

  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

model Order {
  id        Int         @id @default(autoincrement())
  userId    String
  total     Float
  status    OrderStatus @default(PENDING)
  createdAt DateTime    @default(now())

  addressId String?
  address   Address? @relation(fields: [addressId], references: [id])

  paymentId Int?
  payment   Transaction? @relation(fields: [paymentId], references: [id])

  user    User                 @relation(fields: [userId], references: [id])
  items   OrderItem[]
  history OrderStatusHistory[]
}

model OrderStatusHistory {
  id        Int          @id @default(autoincrement())
  orderId   Int
  oldStatus OrderStatus?
  newStatus OrderStatus
  updatedAt DateTime     @default(now())

  order Order @relation(fields: [orderId], references: [id])
}

model OrderItem {
  id        Int   @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int   @default(1)
  price     Float

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

model HomeCategory {
  id         Int       @id @default(autoincrement())
  categoryId Int
  category   Category? @relation(fields: [categoryId], references: [id])
}

model Transaction {
  id            Int      @id @default(autoincrement())
  userId        String
  amount        Int
  paymentStatus Boolean
  date          DateTime
  orders        Order[]
}

model Address {
  id        String  @id @default(uuid())
  userId    String
  firstName String
  lastName  String
  address   String
  locality  String?
  phone     String?
  city      String
  state     String
  pincode   String
  country   String  @default("India")
  isDefault Boolean @default(false)

  user   User    @relation(fields: [userId], references: [id])
  orders Order[]
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PACKED
  SHIPPED
  DELIVERED
  CANCELLED
}

model Review {
  id        Int      @id @default(autoincrement())
  userId    String
  productId Int
  rating    Int
  comment   String?
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@index([userId, productId])
}

model Collection {
  id         Int            @id @default(autoincrement())
  name       String
  type       CollectionType
  buttonName String?
  buttonLink String?
  order      Int            @default(0)

  categories    Category[]
  products      Product[]
  subcategories SubCategory[]
  brands        Brand[]
}

enum CollectionType {
  Category
  SubCategory
  Product
  Brand
}

model Banner {
  id        Int      @id @default(autoincrement())
  title     String?
  imageUrl  String
  link      String?
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
}
